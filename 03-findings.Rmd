# Findings

Figure \@ref(fig:ecdf) shows the empirical cumulative density function for the 
headway deviation data, grouped by TSP threshold. Visually, the difference 
between the various threshold settings is not dramatic. The 5-minute 
threshold appears to have slightly more vehicles arrive ahead of the
scheduled headway, and slightly fewer arrive behind it, than the other three
threshold groups. The median and average of the distribution for all four
thresholds is remarkably similar, and strengthens our determination to 
examine the edges of the distribution with a quantile regression model.

```{r ecdf, fig.cap="Cumulative probability distribution of headway deviation by threshold."}
tar_load(ecdf)
ecdf + 
  xlab("Deviation between scheduled and actual timepoint [minutes]") +
  ylab("Cumulative Probability") +
  scale_color_discrete("TSP Threshold") + 
  scale_y_continuous(breaks = c(0, 0.15, 0.5, 0.85, 1))
```


```{r models}
tar_load(models)

coef_map <- c(
  "(Intercept)" = "(Intercept)", 
  "threshold5 min" = "TSP: 5 minutes",
  "threshold2 min" =  "TSP: 2 minutes",
  "thresholdAlways" = "TSP: Always",
  "directionSB"   = "Southbound", 
  "periodAM Peak" = "AM Peak", 
  "periodPM Peak" = "PM Peak", 
  "directionSB:periodAM Peak" = "Southbound $\\times$ AM Peak",  
  "directionSB:periodPM Peak" = "Southbound $\\times$ PM Peak"
)

f1 <- function(x) format(round(x, 3), big.mark=",")
gm <- list(
  list("raw" = "AIC", "clean" = "AIC", "fmt" = f1),
  list("raw" = "logLik", "clean" = "Log Likelihood", "fmt" = f1)
)
```


```{r models_15}
modelsummary(models[[1]], coef_map = coef_map, gof_map = gm,
             estimate = "{estimate} ({statistic}){stars}",
             statistic = NULL, title = "15th Percentile Regression Estimates", 
             notes = c("t-statistics in parentheses", "* p < 0.1, ** p < 0.05, *** p < 0.01"))
```

```{r models_85}
modelsummary(models[[2]], coef_map = coef_map, gof_map = gm,
             estimate = "{estimate} ({statistic}){stars}",
             statistic = NULL, title = "85th Percentile Regression Estimates", 
             notes = c("t-statistics in parentheses", "* p < 0.1, ** p < 0.05, *** p < 0.01"))
```

Table \@ref(tab:models) presents the estimates of four models with an array 
of explanatory variables. In the model labeled "Threshold," each TSP threshold
is controlled for with a dummy variable; the intercept term suggests that the
85th percentile bus arrives with a headway `r coef(models[[1]])["(Intercept)"]` 
minutes longer than it was supposed to have. The three threshold dummies are
each significant, though the ordering of the coefficients is somewhat unintuitive.
Relative to the situation with no TSP, making TSP always available reduces the 
headway of the 85th percentile bus by `r -1 * coef(models[[1]])["thresholdAlways"]`
minutes, and engaging TSP at a 2-minute threshold reduces the headway by
`r -1 * coef(models[[1]])["threshold2 min"]`. What is not intuitive is that 
engaging TSP with a 5-minute threshold actually makes the 85th percentile
headway `r -1 * coef(models[[1]])["threshold5 min"]` minutes *longer* than 
not using it at all.

The other three models in Table \@ref(tab:models) control for the direction
of the service (southbound buses from Orem to Provo have a longer headway), the
time period (operating in the PM peak lengthens the headway), and an interaction
term between those two variables. With each additional control, the central 
findings related to TSP are unchanged in either magnitude or significance.

The finding that a 5-minute TSP threshold appears to lengthen the headway 
relative to not using TSP at all is curious, and we cannot immediately
account for it. The schedule of threshold changes was not randomized in any way,
and it is possible that the results of this study are tied up in unaccounted
seasonal variations. In spite of this curious finding, we find that --- all else
equal --- TSP marginally improves the headway adherence of late-running BRT
vehicles.
